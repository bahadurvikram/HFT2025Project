---
title: "Quantitative strategies on High Frequency Data - 2025"
author: "Nihad Alili (466258) & Vikram Bahadur (4666547)"
editor: visual
date: "`r Sys.Date()`"
format: 
  html:
    toc: true
    toc-depth: 3
    toc-location: left
    smooth-scroll: true
    toc-title: Contents
    tbl-cap-location: bottom
    lof: true
    lot: true
    theme: spacelab
    highlight: tango
    df-print: kable
    toc_float:
      collapsed: false
      smooth_scroll: true
---

```{r setup, include=FALSE}
library(knitr)

knitr::opts_chunk$set(echo    = TRUE, 
                      cache   = FALSE,
                      message = FALSE, 
                      warning = FALSE)
options(scipen = 10)

```

### Group 1 - Final Strategy - Pair Trading

Considering the NASDAQ index future price and S&P 500 index future price represent the same returns on short/long run. If there is any change it should be temporary and should return back to earlier spread. So pair tradindin with mean reverting.

We used mean reverting pair trading using previous day average closing price ratio based spread and sds (standard deviation) ratios of returns based spread. Initially we tried different combination of entry/exit parameters and found that parameters those fit very well for particular dataset does not mean to fit significantly for the different data set. This because of changes in trends/patterns between data due to course of time. So we decided to find the best parameters on weekly basis and use them to run the pair strategy for next week. So technically every weeks parameters shifted to next week. Therefore for any given data set pre condition becomes it must be more than one week and ultimately we don't trade at all the very first week of any given trade.

#### Assumptions

-   **do not trade** first week of every quarter


-   **do not use in calculations** the data from the first and last 10 minutes of the session (`9:31-9:40` and `15:51-16:00`)

-   do not hold positions overnight (**exit all positions** 20 minutes before the session end, i.e. at `15:40`),

-   **do not trade** within the first 25 minutes of stocks quotations (`9:31-9:55`), but **DO use** the data for `9:41-9:55` in calculations of signal, volatility, etc.

#### Parameters are

-   spread.name = 1 (average mean ratio based spread) or 2 (sd ratio based spread).

-   net.SR = net sharpe ratio based on net pnl.

-   m = multipler to form upper and lower limits of signal.

-   volat.sd = rolling volatility of spread based on 60, 90, 120, 150 or 180 minutes data.

We calculated these parameters on daily basis and analysis them weekly basis to select the best one as per maximum net SR ratio and saved every Friday. Further we moved these parameters to next week Monday morning and filled the whole week as minute data.

Sample parameters from 2024 Quarter 2 (in sample data) looks like

![best_parameters_2024_q2](images/best_parameters_2024_q2.png){width="70%"}

#### Entry/exit technique

Every minutes, parameter "spread.name" type 1 or 2 based value used as signal, parameter "volat.sd" used to define rolling standard deviation of signal and finally multipled with +/- parameter "m" to get the upper and lower limit. If signal crosses the upper limit we go short and vice versa as mean reverting is applied.

#### Strategy performance

Below graph represent net vs gross pnl for out of sample 2024 Q4.

![g1_q4_2024](images/g1_q4_2024.png)

### Group 1 - 2022-2024 quarterly results (out sample data)

```{r}
# Read the CSV file
data <- read.csv("final_results_out_sample.csv")
```

```{r}
# Display the table
knitr::kable(data)

```

## Approaches undertaken

### Group 2

We used the different strategies including and excluding some assets. First of all, we tried based on pair trading using average closing price spread and standard deviation of returns based on spread dividing pairs by currencies(CAD&AUD) and metals(XAU&XAG). The results were not satisfactory.

Secondly, from fundamental perspective, we decided to omit CAD since It has positive relationship with USD which has negative relationship with XAU and It has similar trend pattern with AUD. In our strategy, we used momentum approach using 30 and 90 SMA for AUD and pair of XAU&XAG.

### Group 2- 2022 first quarter results

+--------------+--------------+--------------+--------------+--------------+--------------+--------------+
| gross SR     | net SR       | gross CR     | net CR       | gross cumP&L | net cumP&L   | av.ntrades   |
+==============+==============+==============+==============+==============+==============+==============+
| ```          | ```          | ```          | ```          | ```          | ```          | ```          |
| -0.08796367  | -0.3203243   | -0.1287973   | -0.4405723   | -59418.29    | -215532.6    | 4.611111     |
| ```          | ```          | ```          | ```          | ```          | ```          | ```          |
+--------------+--------------+--------------+--------------+--------------+--------------+--------------+

![g2_q1_2022](images/2022_Q1plot.png)

In the first quarter of 2022, our strategy concluded with negative PnL due to high volatility and Its stat value is -2.3672.

### Group 2 - 2022 third quarter results

+--------------+--------------+--------------+--------------+--------------+--------------+--------------+
| gross SR     | net SR       | gross CR     | net CR       | gross cumP&L | net cumP&L   | av.ntrades   |
+==============+==============+==============+==============+==============+==============+==============+
| ```          | ```          | ```          | ```          | ```          | ```          | ```          |
| 1.00793395   | 0.7994004    |  2.2682883   | 1.6832033    | 838372.21    | 661778.9     | 4.763441     |
| ```          | ```          | ```          | ```          | ```          | ```          | ```          |
+--------------+--------------+--------------+--------------+--------------+--------------+--------------+

![g2_q3_2022](images/2022_Q3plot.png) In the third quarter of 2022, our strategy concluded with profit and Its stat value is 10,9323.

### Group 2 - 2022 fourth quarter results

+--------------+--------------+--------------+--------------+--------------+--------------+--------------+
| gross SR     | net SR       | gross CR     | net CR       | gross cumP&L | net cumP&L   | av.ntrades   |
+==============+==============+==============+==============+==============+==============+==============+
| ```          | ```          | ```          | ```          | ```          | ```          | ```          |
| -0.28367666  | -0.4872866   | -0.5528670   | -0.9162963   | -238877.84   | -408326.5    | 4.901099     |
| ```          | ```          | ```          | ```          | ```          | ```          | ```          |
+--------------+--------------+--------------+--------------+--------------+--------------+--------------+

![g2_q4_2022](images/2022_Q4plot.png)

In the 4th quarter of 2022, our strategy was unsuccesfull, so Its stat value is -5.5088.

### Group 2 - 2023 Second quarter results

+----------+--------+----------+--------+--------------+--------------+------------+
| gross SR | net SR | gross CR | net CR | gross cumP&L | net cumP&L   | av.ntrades |
+==========+========+==========+========+==============+==============+============+
| 1.8115   | 1.5756 | 4.3407   | 3.6753 | 1243477.0309 | 1070183.7479 | 5.1556     |
+----------+--------+----------+--------+--------------+--------------+------------+

![g2_q2_2023](images/2023_Q2plot.png)

In the second quarter of 2023, our stratgey concluded with success and its stat value 25.6372.

### Group 2 - 2023 Fourth quarter results

+----------+--------+----------+--------+--------------+-------------+------------+
| gross SR | net SR | gross CR | net CR | gross cumP&L | net cumP&L  | av.ntrades |
+==========+========+==========+========+==============+=============+============+
| 0.4194   | 0.1852 | 0.9724   | 0.4112 | 323969.7207  | 142276.2714 | 5.0444     |
+----------+--------+----------+--------+--------------+-------------+------------+

![g2_q4_2023](images/2023_Q4plot.png)

In the fiurth quarter of 2023, our strategy was successfull with 2.0388 stat value.

### Group 2 - 2024 First quarter results

+----------+---------+----------+---------+--------------+--------------+------------+
| gross SR | net SR  | gross CR | net CR  | gross cumP&L | net cumP&L   | av.ntrades |
+==========+=========+==========+=========+==============+==============+============+
| -0.1721  | -0.4597 | -0.4496  | -1.0528 | -103307.4365 | -274562.6246 | 4.6957     |
+----------+---------+----------+---------+--------------+--------------+------------+

![g2_q1_2024](images/2024_Q1plot.png) In the first quarter of 2024, our strategy concluded with negative PnL and Its stat value is -5,9118.

### Group 2 - 2024 Second quarter results

+----------+---------+----------+--------+--------------+--------------+------------+
| gross SR | net SR  | gross CR | net CR | gross cumP&L | net cumP&L   | av.ntrades |
+==========+=========+==========+========+==============+==============+============+
| 1.1043   | 0.98689 | 1.8792   | 1.662  | 1670146.1874 | 1487773.1757 | 5.0326     |
+----------+---------+----------+--------+--------------+--------------+------------+

![g2_q2_2024](images/2024_Q2plot.png) In the second quarter of 2024, our strategy concluded with positive PnL and Its stat value is 12.1413.

## Group 2 - 2022-2024 quarterly results

```{r}
data1 <- read.csv("quarter_stats.all.group2.csv")
```

```{r}
#| echo: false
data1
```
